!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react"),require("marked")):"function"==typeof define&&define.amd?define(["exports","react","marked"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).wurd={},t.React,t.marked)}(this,(function(t,e,n){"use strict";function r(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=r(e),i=r(n);function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){f(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function d(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function l(t,e,n){return e&&d(t.prototype,e),n&&d(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function f(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function p(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n,r,o={},i=Object.keys(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}var h=function(t){return!(null==t||"object"!==u(t)||Array.isArray(t))},v=function(t,e){var n=t.length,r=-1;for(;++r<n;)if(e(t[r],r,t))return!0;return!1},y=function(t,e){if(!h(t)||"string"!=typeof e)return t;var n=t;return v(e.split("."),(function(t){if(!(n=n[t]))return!0})),n};var b=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s(this,t),this.rawContent=e}return l(t,[{key:"get",value:function(t){return y(this.rawContent,t)}},{key:"setSections",value:function(t){Object.assign(this.rawContent,t)}}]),t}(),m=function(){function t(e,n){var r=this;s(this,t),this.wurd=e,this.path=n,this._get=e.store.get.bind(e.store),Object.getOwnPropertyNames(Object.getPrototypeOf(this)).forEach((function(t){r[t]=r[t].bind(r)}))}return l(t,[{key:"id",value:function(t){return t?this.path?[this.path,t].join("."):t:this.path}},{key:"get",value:function(t){var e=this._get(this.id(t));if(void 0===e&&this.wurd.draft){var n=t.split(".")[0];this._get(n)||console.warn("Tried to access unloaded section: ".concat(n))}return e}},{key:"text",value:function(t,e){var n=this.get(t);return void 0===n?this.wurd.draft?"[".concat(t,"]"):"":"string"!=typeof n?(console.warn("Tried to get object as string: ".concat(t)),this.wurd.draft?"[".concat(t,"]"):""):(e&&(n=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"!=typeof t||Object.keys(e).forEach((function(n){var r=e[n];t=t.replace(new RegExp("{{".concat(n,"}}"),"g"),r)})),t}(n,e)),n)}},{key:"markdown",value:function(t,e){return i.default(this.text(t,e))}},{key:"map",value:function(t,e){var n=this,r=this.get(t)||f({},Date.now(),{}),o=0;return Object.keys(r).sort().map((function(r){var i=o;o++;var a=[t,r].join("."),c=n.block(a);return e.call(void 0,c,i)}))}},{key:"block",value:function(e,n){var r=this.id(e),o=new t(this.wurd,r);return"function"==typeof n?n.call(void 0,o):o}},{key:"el",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.id(t),o=n.markdown?this.markdown(t,e):this.text(t,e),i=e||n.markdown?"data-wurd-md":"data-wurd";if(this.wurd.draft){var a=n.type||"span";return n.markdown&&(a="div"),"<".concat(a," ").concat(i,'="').concat(r,'">').concat(o,"</").concat(a,">")}return o}}]),t}(),w=function(){function t(e,n){var r=this;s(this,t),this.store=new b,this.content=new m(this,null),Object.getOwnPropertyNames(Object.getPrototypeOf(this.content)).forEach((function(t){r[t]=r.content[t].bind(r.content)})),this.connect(e,n)}return l(t,[{key:"connect",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(this.app=t,this.draft=!1,this.editMode=!1,["draft","lang","debug"].forEach((function(t){var r=n[t];void 0!==r&&(e[t]=r)})),n.editMode){case!0:this.startEditor();break;case"querystring":/[?&]edit(&|$)/.test(location.search)&&this.startEditor()}return n.rawContent&&this.store.setSections(n.rawContent),n.blockHelpers&&this.setBlockHelpers(n.blockHelpers),this}},{key:"load",value:function(t){var e=this,n=this.app,r=this.store,o=this.debug;return new Promise((function(i,a){if(!n)return a(new Error("Use wurd.connect(appName) before wurd.load()"));var c=r.get(t);if(c)return o&&console.info("from cache: ",t),i(c);o&&console.info("from server: ",t);var u,s=["draft","lang"].reduce((function(t,n){return e[n]&&(t[n]=e[n]),t}),{}),d="".concat("https://api-v3.wurd.io","/apps/").concat(n,"/content/").concat(t,"?").concat((u=s,Object.keys(u).map((function(t){var e=u[t];return encodeURIComponent(t)+"="+encodeURIComponent(e)})).join("&")));return fetch(d).then((function(t){return t.json()})).then((function(n){if(n.error)throw n.error.message?new Error(n.error.message):new Error("Error loading ".concat(t));r.setSections(n),i(e.content)})).catch((function(t){return a(t)}))}))}},{key:"startEditor",value:function(){var t=this.app,e=this.lang;this.editMode=!0,this.draft=!0;var n=document.createElement("script");n.src="https://edit-v3.wurd.io/widget.js",n.async=!0,n.setAttribute("data-app",t),e&&n.setAttribute("data-lang",e),document.getElementsByTagName("body")[0].appendChild(n)}},{key:"setBlockHelpers",value:function(t){Object.assign(m.prototype,t)}}]),t}(),g=new w;g.Wurd=w;var k=["block","id","sid","type","component","vars"];function O(t){var e=t.block,n=t.id,r=t.sid,i=t.type,a=void 0===i?"span":i,u=t.component,s=void 0===u?a:u,d=t.vars,l=p(t,k),f=(e=e||g.content).text(n,d),h=c({},l);g.editMode&&(h[d?"data-wurd-md":"data-wurd"]=e.id(r||n));return o.default.createElement(s,h,f)}var j=["block","id","sid","type","component","vars"];function E(t){var e=t.block,n=t.id,r=t.sid,i=t.type,a=void 0===i?"div":i,u=t.component,s=void 0===u?a:u,d=t.vars,l=p(t,j),f=(e=e||g.content).markdown(n,d),h=c(c({},l),{},{dangerouslySetInnerHTML:{__html:f}});return g.editMode&&(h["data-wurd-md"]=e.id(r||n)),o.default.createElement(s,h)}var P=["block","id","sid"];function x(t){var e=t.block,n=t.id,r=t.sid,i=p(t,P),a=(e=e||g.content).text(n),u=c(c({},i),{},{src:a});return g.editMode&&(u["data-wurd-img"]=e.id(r||n)),o.default.createElement("img",u)}var S=["block","id","children","type","component","keys"];function M(t){var e=t.block,n=t.id,r=t.children,i=t.type,a=void 0===i?"ul":i,u=t.component,s=void 0===u?a:u,d=t.keys,l=void 0===d?"title":d,f=p(t,S);e=e||g.content;var h=c({},f);return g.editMode&&(h["data-wurd-list"]=e.id(n),h["data-wurd-list-props"]=l),o.default.createElement(s,h,e.map(n,(function(t,e){return r(t,e)})))}var C=["block","id","sid","keys","type","component","children"];function T(t){var e=t.block,n=t.id,r=t.sid,i=t.keys,a=t.type,u=void 0===a?"span":a,s=t.component,d=void 0===s?u:s,l=t.children,f=p(t,C);e=e||g.content;var h=c({},f);return g.editMode&&(h["data-wurd-obj"]=e.id(r||n),h["data-wurd-obj-props"]=Array.isArray(i)?i.join(","):i),o.default.createElement(d,h,l)}g.setBlockHelpers({Text:function(t){return o.default.createElement(O,c({block:this},t))},Markdown:function(t){return o.default.createElement(E,c({block:this},t))},Image:function(t){return o.default.createElement(x,c({block:this},t))},List:function(t){return o.default.createElement(M,c({block:this},t))},Object:function(t){return o.default.createElement(T,c({block:this},t))}}),t.WurdImage=x,t.WurdList=M,t.WurdMarkdown=E,t.WurdObject=T,t.WurdText=O,t.default=g,Object.defineProperty(t,"__esModule",{value:!0})}));
