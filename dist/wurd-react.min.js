!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).wurd={},t.React)}(this,function(t,e){"use strict";function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var f=n(e);function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach(function(t){u(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function h(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n,r,o={},i=Object.keys(t);for(r=0;r<i.length;r++)n=i[r],0<=e.indexOf(n)||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],0<=e.indexOf(n)||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}var a=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};i(this,e),this.rawContent=t}return c(e,[{key:"get",value:function(t){return t?t.split(".").reduce(function(t,e){return t&&t[e]},this.rawContent):this.rawContent}},{key:"getSections",value:function(t){var e=this,n=t.map(function(t){return[t,e.rawContent[t]]});return Object.fromEntries(n)}},{key:"setSections",value:function(t){Object.assign(this.rawContent,t)}}]),e}(),s=function(){function o(t,e){var n=this;i(this,o),this.wurd=t,this.path=e,this._get=t.store.get.bind(t.store),Object.getOwnPropertyNames(Object.getPrototypeOf(this)).forEach(function(t){n[t]=n[t].bind(n)})}return c(o,[{key:"id",value:function(t){return t?this.path?[this.path,t].join("."):t:this.path}},{key:"get",value:function(t){var e=this._get(this.id(t));if(void 0===e&&this.wurd.draft){var n=t.split(".")[0];this._get(n)||console.warn("Tried to access unloaded section: ".concat(n))}return e}},{key:"text",value:function(t,e){var n=this.get(t);return void 0===n?this.wurd.draft?"[".concat(t,"]"):"":"string"!=typeof n?(console.warn("Tried to get object as string: ".concat(t)),this.wurd.draft?"[".concat(t,"]"):""):(e&&(n=function(t,e){var n=1<arguments.length&&void 0!==e?e:{};return"string"!=typeof t?t:t.replace(/{{([\w.-]+)}}/g,function(t,e){return n[e]||""})}(n,e)),n)}},{key:"markdown",value:function(t,e,n){var r=this.wurd.markdown,o=r.parse,i=r.parseInline,c=this.text(t,e);return null!=n&&n.inline&&i?i(c):o?o(c):c}},{key:"map",value:function(o,i){var c=this,t=this.get(o)||u({},Date.now(),{}),a=0;return Object.keys(t).sort().map(function(t){var e=a;a++;var n=[o,t].join("."),r=c.block(n);return i.call(void 0,r,e)})}},{key:"block",value:function(t,e){var n=this.id(t),r=new o(this.wurd,n);return"function"==typeof e?e.call(void 0,r):r}},{key:"el",value:function(t,e,n){var r=2<arguments.length&&void 0!==n?n:{},o=this.id(t),i=r.markdown?this.markdown(t,e):this.text(t,e),c=e||r.markdown?"data-wurd-md":"data-wurd";if(this.wurd.draft){var a=r.type||"span";return r.markdown&&(a="div"),"<".concat(a," ").concat(c,'="').concat(o,'">').concat(i,"</").concat(a,">")}return i}}]),o}(),d=function(){function r(t,e){var n=this;i(this,r),this.store=new a,this.content=new s(this,null),Object.getOwnPropertyNames(Object.getPrototypeOf(this.content)).forEach(function(t){n[t]=n.content[t].bind(n.content)}),this.connect(t,e)}return c(r,[{key:"connect",value:function(t,e){var n=this,r=1<arguments.length&&void 0!==e?e:{};switch(this.app=t,this.draft=!1,this.editMode=!1,["draft","lang","markdown","debug"].forEach(function(t){var e=r[t];void 0!==e&&(n[t]=e)}),r.editMode){case!0:this.startEditor();break;case"querystring":/[?&]edit(&|$)/.test(location.search)&&this.startEditor()}return r.rawContent&&this.store.setSections(r.rawContent),r.blockHelpers&&this.setBlockHelpers(r.blockHelpers),this}},{key:"load",value:function(o){var i=this,c=this.app,a=this.store,u=this.debug;return new Promise(function(e,n){if(!c)return n(new Error("Use wurd.connect(appName) before wurd.load()"));"string"==typeof o&&(o=o.split(","));var r=a.getSections(o),t=Object.keys(r).filter(function(t){return void 0===r[t]});return u&&console.info("from cache: ",t),t.length?(u&&console.info("from server: ",t),i._fetchSections(t).then(function(t){a.setSections(t),e(i.content)}).catch(function(t){return n(t)})):e(i.content)})}},{key:"_fetchSections",value:function(e){var n,r=this,t=this.app,o=["draft","lang"].reduce(function(t,e){return r[e]&&(t[e]=r[e]),t},{}),i="".concat("https://api.wurd.io","/apps/").concat(t,"/content/").concat(e,"?").concat((n=o,Object.keys(n).map(function(t){var e=n[t];return encodeURIComponent(t)+"="+encodeURIComponent(e)}).join("&")));return this._fetch(i).then(function(t){if(t.error)throw t.error.message?new Error(t.error.message):new Error("Error loading ".concat(e));return t})}},{key:"_fetch",value:function(e){return fetch(e).then(function(t){if(!t.ok)throw new Error("Error loading ".concat(e,": ").concat(t.statusText));return t.json()})}},{key:"startEditor",value:function(){var t=this.app,e=this.lang;this.editMode=!0,this.draft=!0;var n=document.createElement("script");n.src="https://widget.wurd.io/widget.js",n.async=!0,n.setAttribute("data-app",t),e&&n.setAttribute("data-lang",e),document.getElementsByTagName("body")[0].appendChild(n)}},{key:"setBlockHelpers",value:function(t){Object.assign(s.prototype,t)}}]),r}(),v=new d;v.Wurd=d;var b=["block","id","sid","type","component","vars"];function l(t){var e=t.block,n=t.id,r=t.sid,o=t.type,i=void 0===o?"span":o,c=t.component,a=void 0===c?i:c,u=t.vars,s=h(t,b),d=(e=e||v.content).text(n,u),l=p({},s);v.editMode&&(l[u?"data-wurd-md":"data-wurd"]=e.id(r||n));return f.default.createElement(a,l,d)}var y=["block","id","sid","type","component","vars"];function w(t){var e=t.block,n=t.id,r=t.sid,o=t.type,i=void 0===o?"div":o,c=t.component,a=void 0===c?i:c,u=t.vars,s=h(t,y),d=(e=e||v.content).markdown(n,u),l=p(p({},s),{},{dangerouslySetInnerHTML:{__html:d}});return v.editMode&&(l["data-wurd-md"]=e.id(r||n)),f.default.createElement(a,l)}var m=["block","id","sid"];function g(t){var e=t.block,n=t.id,r=t.sid,o=h(t,m),i=(e=e||v.content).text(n),c=p(p({},o),{},{src:i});return v.editMode&&(c["data-wurd-img"]=e.id(r||n)),f.default.createElement("img",c)}var k=["block","id","children","type","component","keys"];function O(t){var e=t.block,n=t.id,r=t.children,o=t.type,i=void 0===o?"ul":o,c=t.component,a=void 0===c?i:c,u=t.keys,s=void 0===u?"title":u,d=h(t,k);e=e||v.content;var l=p({},d);return v.editMode&&(l["data-wurd-list"]=e.id(n),l["data-wurd-list-props"]=s),f.default.createElement(a,l,e.map(n,function(t,e){return r(t,e)}))}var j=["block","id","sid","keys","type","component","children"];function E(t){var e=t.block,n=t.id,r=t.sid,o=t.keys,i=t.type,c=void 0===i?"span":i,a=t.component,u=void 0===a?c:a,s=t.children,d=h(t,j);e=e||v.content;var l=p({},d);return v.editMode&&(l["data-wurd-obj"]=e.id(r||n),l["data-wurd-obj-props"]=Array.isArray(o)?o.join(","):o),f.default.createElement(u,l,s)}v.setBlockHelpers({Text:function(t){return f.default.createElement(l,p({block:this},t))},Markdown:function(t){return f.default.createElement(w,p({block:this},t))},Image:function(t){return f.default.createElement(g,p({block:this},t))},List:function(t){return f.default.createElement(O,p({block:this},t))},Object:function(t){return f.default.createElement(E,p({block:this},t))}}),t.WurdImage=g,t.WurdList=O,t.WurdMarkdown=w,t.WurdObject=E,t.WurdText=l,t.default=v,Object.defineProperty(t,"__esModule",{value:!0})});
