!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).wurd={},t.React)}(this,function(t,e){"use strict";function r(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var f=r(e);function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach(function(t){s(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e,r){return e&&o(t.prototype,e),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function p(t,e){if(null==t)return{};var r,n,o=function(t,e){if(null==t)return{};var r,n,o={},i=Object.keys(t);for(n=0;n<i.length;n++)r=i[n],0<=e.indexOf(r)||(o[r]=t[r]);return o}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;n<i.length;n++)r=i[n],0<=e.indexOf(r)||Object.prototype.propertyIsEnumerable.call(t,r)&&(o[r]=t[r])}return o}var c=function(){function n(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};i(this,n),this.rawContent=e,this.storageKey=r.storageKey||"wurdContent",this.ttl=null!==(t=r.ttl)&&void 0!==t?t:36e5}return a(n,[{key:"get",value:function(t){return t?t.split(".").reduce(function(t,e){return t&&t[e]},this.rawContent):this.rawContent}},{key:"load",value:function(t,e){var r=(1<arguments.length&&void 0!==e?e:{}).lang,n=this.rawContent,o=this.storageKey,i=this.ttl;try{var a=JSON.parse(localStorage.getItem(o)),c=a&&a._wurd;return!a||!c||c.savedAt+i<Date.now()?n:(c.lang!==r||(delete a._wurd,Object.assign(n,a)),n)}catch(t){return console.error("Wurd: error loading cache:",t),n}}},{key:"save",value:function(t,e){var r=(1<arguments.length&&void 0!==e?e:{}).lang,n=this.rawContent,o=this.storageKey;Object.assign(n,t),localStorage.setItem(o,JSON.stringify(h(h({},n),{},{_wurd:{savedAt:Date.now(),lang:r}})))}},{key:"clear",value:function(){localStorage.removeItem(this.storageKey)}}]),n}(),u=function(){function o(t,e){var r=this;i(this,o),this.wurd=t,this.path=e,this._get=t.store.get.bind(t.store),Object.getOwnPropertyNames(Object.getPrototypeOf(this)).forEach(function(t){r[t]=r[t].bind(r)})}return a(o,[{key:"id",value:function(t){return t?this.path?[this.path,t].join("."):t:this.path}},{key:"get",value:function(t){var e=this._get(this.id(t));if(void 0===e&&this.wurd.draft){var r=t.split(".")[0];this._get(r)||console.warn("Tried to access unloaded section: ".concat(r))}return e}},{key:"text",value:function(t,e){var r=this.get(t);return void 0===r?this.wurd.draft?"[".concat(t,"]"):"":"string"!=typeof r?(console.warn("Tried to get object as string: ".concat(t)),this.wurd.draft?"[".concat(t,"]"):""):(e&&(r=function(t,e){var r=1<arguments.length&&void 0!==e?e:{};return"string"!=typeof t?t:t.replace(/{{([\w.-]+)}}/g,function(t,e){return r[e]||""})}(r,e)),r)}},{key:"markdown",value:function(t,e,r){var n=this.wurd.markdown,o=n.parse,i=n.parseInline,a=this.text(t,e);return null!=r&&r.inline&&i?i(a):o?o(a):a}},{key:"map",value:function(o,i){var a=this,t=this.get(o)||s({},Date.now(),{}),c=0;return Object.keys(t).sort().map(function(t){var e=c;c++;var r=[o,t].join("."),n=a.block(r);return i.call(void 0,n,e)})}},{key:"block",value:function(t,e){var r=this.id(t),n=new o(this.wurd,r);return"function"==typeof e?e.call(void 0,n):n}},{key:"el",value:function(t,e,r){var n=2<arguments.length&&void 0!==r?r:{},o=this.id(t),i=n.markdown?this.markdown(t,e):this.text(t,e),a=e||n.markdown?"data-wurd-md":"data-wurd";if(this.wurd.draft){var c=n.type||"span";return n.markdown&&(c="div"),"<".concat(c," ").concat(a,'="').concat(o,'">').concat(i,"</").concat(c,">")}return i}}]),o}(),d=function(){function n(t){var e=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};i(this,n),this.widgetUrl="https://widget.wurd.io/widget.js",this.apiUrl="https://api.wurd.io",this.store=new c,this.content=new u(this,null),Object.getOwnPropertyNames(Object.getPrototypeOf(this.content)).forEach(function(t){e[t]=e.content[t].bind(e.content)}),this.connect(t,r)}return a(n,[{key:"connect",value:function(t,e){var r=this,n=1<arguments.length&&void 0!==e?e:{};switch(this.app=t,this.draft=!1,this.editMode=!1,["draft","lang","markdown","debug","onLoad"].forEach(function(t){var e=n[t];void 0!==e&&(r[t]=e)}),n.editMode){case!0:this.startEditor();break;case"querystring":/[?&]edit(&|$)/.test(location.search)&&this.startEditor()}return n.rawContent&&this.store.save(n.rawContent,{lang:n.lang}),n.storageKey&&(this.store.storageKey=n.storageKey),n.ttl&&(this.store.ttl=n.ttl),n.blockHelpers&&this.setBlockHelpers(n.blockHelpers),this}},{key:"load",value:function(t){var e=this.app,r=this.store,n=this.lang,o=this.editMode,i=this.debug,a=this.onLoad,c=this.content;if(!e)return Promise.reject(new Error("Use wurd.connect(appName) before wurd.load()"));var s="string"==typeof t?t.split(","):t;if(o)return this._fetchSections(s).then(function(t){return r.save(t,{lang:n}),r.clear(),a&&a(c),c});var u=r.load(s,{lang:n}),d=s.filter(function(t){return void 0===u[t]});return i&&console.info("Wurd: from cache:",s.filter(function(t){return void 0!==u[t]})),0===d.length?(a&&a(c),Promise.resolve(c)):this._fetchSections(d).then(function(t){return r.save(t,{lang:n}),a&&a(c),c})}},{key:"_fetchSections",value:function(e){var r=this,t=this.app;this.debug&&console.info("Wurd: from server:",e);var n,o=["draft","lang"].reduce(function(t,e){return r[e]&&(t[e]=r[e]),t},{}),i="".concat(this.apiUrl,"/apps/").concat(t,"/content/").concat(e,"?").concat((n=o,Object.keys(n).map(function(t){var e=n[t];return encodeURIComponent(t)+"="+encodeURIComponent(e)}).join("&")));return this._fetch(i).then(function(t){if(t.error)throw t.error.message?new Error(t.error.message):new Error("Error loading ".concat(e));return t})}},{key:"_fetch",value:function(e){return fetch(e).then(function(t){if(!t.ok)throw new Error("Error loading ".concat(e,": ").concat(t.statusText));return t.json()})}},{key:"startEditor",value:function(){var t=this.app,e=this.lang;this.editMode=!0,this.draft=!0;var r=document.createElement("script");r.src=this.widgetUrl,r.async=!0,r.setAttribute("data-app",t),e&&r.setAttribute("data-lang",e);var n=document.body.querySelector('script[src="'.concat(this.widgetUrl,'"]'));n&&document.body.removeChild(n),document.body.appendChild(r)}},{key:"setBlockHelpers",value:function(t){Object.assign(u.prototype,t)}}]),n}(),v=new d;v.Wurd=d;var g=["block","id","sid","type","component","vars"];function l(t){var e=t.block,r=t.id,n=t.sid,o=t.type,i=void 0===o?"span":o,a=t.component,c=void 0===a?i:a,s=t.vars,u=p(t,g),d=(e=e||v.content).text(r,s),l=h({},u);v.editMode&&(l[s?"data-wurd-md":"data-wurd"]=e.id(n||r));return f.default.createElement(c,l,d)}var y=["block","id","sid","type","component","vars"];function b(t){var e=t.block,r=t.id,n=t.sid,o=t.type,i=void 0===o?"div":o,a=t.component,c=void 0===a?i:a,s=t.vars,u=p(t,y),d=(e=e||v.content).markdown(r,s),l=h(h({},u),{},{dangerouslySetInnerHTML:{__html:d}});return v.editMode&&(l["data-wurd-md"]=e.id(n||r)),f.default.createElement(c,l)}var w=["block","id","sid"];function m(t){var e=t.block,r=t.id,n=t.sid,o=p(t,w),i=(e=e||v.content).text(r),a=h(h({},o),{},{src:i});return v.editMode&&(a["data-wurd-img"]=e.id(n||r)),f.default.createElement("img",a)}var k=["block","id","children","type","component","keys"];function O(t){var e=t.block,r=t.id,n=t.children,o=t.type,i=void 0===o?"ul":o,a=t.component,c=void 0===a?i:a,s=t.keys,u=void 0===s?"title":s,d=p(t,k);e=e||v.content;var l=h({},d);return v.editMode&&(l["data-wurd-list"]=e.id(r),l["data-wurd-list-props"]=u),f.default.createElement(c,l,e.map(r,function(t,e){return n(t,e)}))}var j=["block","id","sid","keys","type","component","children"];function E(t){var e=t.block,r=t.id,n=t.sid,o=t.keys,i=t.type,a=void 0===i?"span":i,c=t.component,s=void 0===c?a:c,u=t.children,d=p(t,j);e=e||v.content;var l=h({},d);return v.editMode&&(l["data-wurd-obj"]=e.id(n||r),l["data-wurd-obj-props"]=Array.isArray(o)?o.join(","):o),f.default.createElement(s,l,u)}v.setBlockHelpers({Text:function(t){return f.default.createElement(l,h({block:this},t))},Markdown:function(t){return f.default.createElement(b,h({block:this},t))},Image:function(t){return f.default.createElement(m,h({block:this},t))},List:function(t){return f.default.createElement(O,h({block:this},t))},Object:function(t){return f.default.createElement(E,h({block:this},t))}}),t.WurdImage=m,t.WurdList=O,t.WurdMarkdown=b,t.WurdObject=E,t.WurdText=l,t.default=v,Object.defineProperty(t,"__esModule",{value:!0})});
